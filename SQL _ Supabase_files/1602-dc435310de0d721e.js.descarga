!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="02614b3b-6112-4dec-8d18-f8399a9454e5",e._sentryDebugIdIdentifier="sentry-dbid-02614b3b-6112-4dec-8d18-f8399a9454e5")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1602],{45862:function(e,t,n){n.d(t,{l5:function(){return eg.Z},mM:function(){return eE}});var i=n(97458),a=n(198),o=n(36457),r=n(26969),l=n.n(r),s=n(86474),c=n.n(s),d=n(32691),u=n(34549),m=n(12436),f=n(62095),h=n(27850),p=n(88971),g=n(67096),x=n(89199),v=n(79790),y=n(91209),b=n(90817),j=n(72048),w=n(53114),S=n(96444),N=n(56844),D=n(24561),C=n(96226),A=n(74828),E=n(11024),R=n(61379),_=n(37722),k=n(83145),L=n.n(k),z=n(52983),Z=n(98495),T=n(99359),I=n(26233),F=n(359),q=n(92259),O=n(52417),W=n(1575),M=n(44353),V=n(82288),U=n(41135),Q=n(71147),G=n(40577),P=n(90839),J=n(65092),K=n(42026),H=n(32472),X=n(32002),B=n(96273),Y=n(28894),$=n(25878),ee=n(7324);let et=e=>{let{id:t}=e;if(!t)throw Error("id is required");return"\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name,\n        to_regclass(concat('\"', n.nspname, '\".\"', c.relname, '\"')) as regclass\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ".concat(t,"\n    )\n    select pg_get_viewdef(t.regclass, true) as definition\n    from table_info t\n  ").trim()};async function en(e,t){let{projectRef:n,connectionString:i,id:a}=e,o=et({id:a}),{result:r}=await (0,$.R)({projectRef:n,connectionString:i,sql:o,queryKey:["view-definition",a]},t);return r[0].definition.trim()}let ei=function(e){let{projectRef:t,connectionString:n,id:i}=e,{enabled:a=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,Y.a)(ee.A.viewDefinition(t,i),e=>{let{signal:a}=e;return en({projectRef:t,connectionString:n,id:i},a)},{enabled:a&&void 0!==t&&void 0!==i&&!isNaN(i),...o})};var ea=n(66802),eo=n(64890),er=n(35808),el=n(3190);function es(e){let{table:t,isAutofixViewSecurityModalOpen:n,setIsAutofixViewSecurityModalOpen:a}=e,{project:r}=(0,p.d2)(),l=(0,o.NL)(),s=ei({id:null==t?void 0:t.id,projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),{mutate:c}=(0,ea.r)({onSuccess:async()=>{u.Am.success("View security changed successfully"),a(!1),await l.invalidateQueries(el.X.lint(null==r?void 0:r.ref))},onError:e=>{u.Am.error("Failed to autofix view security: ".concat(e.message))}});return(0,i.jsxs)(X.Z,{visible:n,size:"xlarge",title:"Confirm autofixing view security",confirmLabel:"Confirm",onCancel:()=>a(!1),onConfirm:()=>{!function(){let e='\n	ALTER VIEW "'.concat(t.schema,'"."').concat(t.name,'" SET (security_invoker = on);\n	');c({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,sql:e})}()},"data-sentry-element":"ConfirmationModal","data-sentry-component":"ViewEntityAutofixSecurityModal","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:[(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:["Setting ",(0,i.jsx)("code",{children:"security_invoker=on"})," ensures the View runs with the permissions of the querying user, reducing the risk of unintended data exposure."]}),(0,i.jsxs)("div",{className:"flex items-center gap-8 mt-8",children:[(0,i.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,i.jsx)("div",{className:"p-4 bg-200 font-mono text-sm font-semibold",children:"Existing query"}),(0,i.jsx)(eo.x,{className:"h-[225px] px-4 py-2","data-sentry-element":"ScrollArea","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:s.data&&(0,i.jsx)(er.c,{children:"create view ".concat(t.schema,".").concat(t.name," as\n ").concat(s.data)})})]}),(0,i.jsxs)("div",{className:" border rounded-md w-1/2",children:[(0,i.jsx)("div",{className:"p-4 bg-200 font-mono text-sm font-semibold",children:"Updated query"}),(0,i.jsx)(eo.x,{className:"h-[225px] px-4 py-2","data-sentry-element":"ScrollArea","data-sentry-source-file":"ViewEntityAutofixSecurityModal.tsx",children:s.data&&(0,i.jsx)(er.c,{children:"create view ".concat(t.schema,".").concat(t.name," with (security_invoker = on) as\n ").concat(s.data)})})]})]})]})}var ec=n(75541),ed=e=>{var t;let{table:n}=e,{ref:o}=(0,m.UO)(),{project:r}=(0,p.d2)(),l=(0,ec.l)(),{data:s=[]}=(0,M.U)({projectRef:null==r?void 0:r.ref}),c=(0,x.N3)(n),d=(0,x.GV)(n),f=(0,x.Du)(n),h=(0,x.z_)(n),g=(0,Q.N)("realtime:all"),v=S.s.includes(n.schema),{mutate:y}=(0,U.V)({onError:e=>{u.Am.error("Failed to toggle RLS: ".concat(e.message))},onSettled:()=>{ew()}}),[j,w]=(0,z.useState)(!1),[N,D]=(0,z.useState)(!1),[C,k]=(0,z.useState)(!1),[Y,$]=(0,z.useState)(!1),{selectedRows:ee}=(0,Z.Qq)(),et=0===ee.size,en=null==r?void 0:r.ref,{data:ei}=(0,q.r)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),ea=(null!=ei?ei:[]).filter(e=>e.schema===n.schema&&e.table===n.name),{data:eo}=(0,O.z)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),er=(null!=eo?eo:[]).find(e=>"supabase_realtime"===e.name),el=null!==(t=null==er?void 0:er.tables)&&void 0!==t?t:[],ed=el.some(e=>e.id===(null==n?void 0:n.id)),{mutate:eu,isLoading:em}=(0,W.u)({onSuccess:()=>{D(!1)},onError:e=>{u.Am.error("Failed to toggle realtime for ".concat(n.name,": ").concat(e.message))}}),ef=(0,b.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"tables"),eh=(0,b.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"columns"),ep="public"===n.schema,{hasLint:eg,matchingLint:ex}=(0,T.R)(n.name,"security_definer_view",["ERROR","WARN"],s,n.schema),{hasLint:ev,matchingLint:ey}=(0,T.R)(n.name,"materialized_view_in_api",["ERROR","WARN"],s,n.schema),{mutate:eb}=(0,V.a)(),ej=async()=>{var e,t;if(!r)return console.error("Project is required");if(!er)return console.error("Unable to find realtime publication");let i=el.some(e=>e.id==n.id),a=i?el.filter(e=>e.id!=n.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(n.schema,".").concat(n.name)].concat(el.map(e=>"".concat(e.schema,".").concat(e.name)));eb({action:"realtime_toggle_table_clicked",properties:{newState:i?"disabled":"enabled",origin:"tableGridHeader"},groups:{project:null!==(e=null==r?void 0:r.ref)&&void 0!==e?e:"Unknown",organization:null!==(t=null==l?void 0:l.slug)&&void 0!==t?t:"Unknown"}}),eu({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,id:er.id,tables:a})},ew=()=>{k(!1)},eS=async()=>{let e={id:n.id,rls_enabled:!(c&&n.rls_enabled)};y({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,id:e.id,schema:n.schema,payload:e})};return(0,i.jsxs)(i.Fragment,{children:[et&&(0,i.jsxs)("div",{className:"flex items-center gap-x-2",children:[!ef&&!eh&&(0,i.jsxs)(G.u,{children:[(0,i.jsx)(G.aJ,{asChild:!0,children:(0,i.jsx)("div",{className:"border border-strong rounded bg-overlay-hover px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,i.jsx)(G._v,{side:"bottom",children:"You need additional permissions to manage your project's data"})]}),c&&!v?n.rls_enabled?(0,i.jsx)(i.Fragment,{children:ea.length<1&&!v?(0,i.jsx)(F.u,{asChild:!0,type:"default",className:"group",icon:(0,i.jsx)(A.Z,{strokeWidth:1.5,className:"text-foreground-muted"}),tooltip:{content:{side:"bottom",className:"w-[280px]",text:"RLS is enabled for this table, but no policies are set. Select queries may return 0 results."}},children:(0,i.jsx)(L(),{passHref:!0,href:"/project/".concat(en,"/auth/policies?search=").concat(n.id,"&schema=").concat(n.schema),children:"Add RLS policy"})}):(0,i.jsx)(P.z,{asChild:!0,type:ea.length<1&&!v?"warning":"default",className:"group",icon:v||ea.length>0?(0,i.jsx)("div",{className:(0,J.cn)("flex items-center justify-center rounded-full bg-border-stronger h-[16px]",ea.length>9?" px-1":"w-[16px]",""),children:(0,i.jsx)("span",{className:"text-[11px] text-foreground font-mono text-center",children:ea.length})}):(0,i.jsx)(A.Z,{strokeWidth:1.5}),children:(0,i.jsxs)(L(),{passHref:!0,href:"/project/".concat(en,"/auth/policies?search=").concat(n.id,"&schema=").concat(n.schema),children:["Auth ",ea.length>1?"policies":"policy"]})})}):(0,i.jsxs)(K.J2,{open:j,onOpenChange:()=>w(!j),modal:!1,children:[(0,i.jsx)(K.xo,{asChild:!0,children:(0,i.jsx)(P.z,{type:"warning",icon:(0,i.jsx)(E.Z,{strokeWidth:1.5}),children:"RLS disabled"})}),(0,i.jsxs)(K.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(E.Z,{size:16})," Row Level Security (RLS)"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"You can restrict and control who can read, write and update data in this table using Row Level Security."}),(0,i.jsx)("p",{children:"With RLS enabled, anonymous users will not be able to read/write data in the table."}),!v&&(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(P.z,{type:"default",onClick:()=>k(!C),children:"Enable RLS for this table"})})]})]})]}):null,f&&eg&&(0,i.jsxs)(K.J2,{open:j,onOpenChange:()=>w(!j),modal:!1,children:[(0,i.jsx)(K.xo,{asChild:!0,children:(0,i.jsx)(P.z,{type:"warning",icon:(0,i.jsx)(R.Z,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,i.jsxs)(K.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(R.Z,{size:16})," Secure your View"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,i.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,i.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,i.jsx)(P.z,{type:"secondary",onClick:()=>{$(!0)},children:"Autofix"}),(0,i.jsx)(P.z,{type:"default",asChild:!0,children:(0,i.jsx)(L(),{target:"_blank",href:"/project/".concat(o,"/advisors/security?preset=").concat(null==ex?void 0:ex.level,"&id=").concat(null==ex?void 0:ex.cache_key),children:"Learn more"})})]})]})]})]}),h&&ev&&(0,i.jsxs)(K.J2,{open:j,onOpenChange:()=>w(!j),modal:!1,children:[(0,i.jsx)(K.xo,{asChild:!0,children:(0,i.jsx)(P.z,{type:"warning",icon:(0,i.jsx)(R.Z,{strokeWidth:1.5}),children:"Security Definer view"})}),(0,i.jsxs)(K.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(R.Z,{size:16})," Secure your View"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"This view is defined with the Security Definer property, giving it permissions of the view's creator (Postgres), rather than the permissions of the querying user."}),(0,i.jsx)("p",{children:"Since this view is in the public schema, it is accessible via your project's APIs."}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(P.z,{type:"default",asChild:!0,children:(0,i.jsx)(L(),{target:"_blank",href:"/project/".concat(o,"/advisors/security?preset=").concat(null==ey?void 0:ey.level,"&id=").concat(null==ey?void 0:ey.cache_key),children:"Learn more"})})})]})]})]}),d&&"public"===n.schema&&(0,i.jsxs)(K.J2,{open:j,onOpenChange:()=>w(!j),modal:!1,children:[(0,i.jsx)(K.xo,{asChild:!0,children:(0,i.jsx)(P.z,{type:"warning",icon:(0,i.jsx)(R.Z,{strokeWidth:1.5}),children:"Foreign table is accessible via your project's APIs"})}),(0,i.jsxs)(K.yk,{className:"min-w-[395px] text-sm",align:"end",children:[(0,i.jsxs)("h3",{className:"flex items-center gap-2",children:[(0,i.jsx)(R.Z,{size:16})," Secure Foreign table"]}),(0,i.jsxs)("div",{className:"grid gap-2 mt-4 text-foreground-light text-sm",children:[(0,i.jsx)("p",{children:"Foreign tables do not enforce RLS. Move them to a private schema not exposed to Postgrest or disable Postgrest."}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(P.z,{type:"default",asChild:!0,children:(0,i.jsx)(L(),{target:"_blank",href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview#security",children:"Learn more"})})})]})]})]}),(0,i.jsx)(B.Q,{serviceRoleLabel:"postgres"}),c&&g&&(0,i.jsxs)(P.z,{type:"default",icon:(0,i.jsx)(_.Z,{strokeWidth:1.5,className:ed?"text-brand":"text-foreground-muted"}),onClick:()=>D(!0),children:["Realtime ",ed?"on":"off"]}),ep&&(0,i.jsx)(I.Z,{section:["entities",n.name]})]}),(0,i.jsx)(X.Z,{visible:N,loading:em,title:"".concat(ed?"Disable":"Enable"," realtime for ").concat(n.name),confirmLabel:"".concat(ed?"Disable":"Enable"," realtime"),confirmLabelLoading:"".concat(ed?"Disabling":"Enabling"," realtime"),onCancel:()=>D(!1),onConfirm:()=>ej(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"GridHeaderActions.tsx",children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("p",{className:"text-sm",children:["Once realtime has been ",ed?"disabled":"enabled",", the table will"," ",ed?"no longer ":"","broadcast any changes to authorized subscribers."]}),!ed&&(0,i.jsxs)("p",{className:"text-sm",children:["You may also select which events to broadcast to subscribers on the"," ",(0,i.jsx)(L(),{href:"/project/".concat(o,"/database/publications"),className:"text-brand",children:"database publications"})," ","settings."]})]})}),(0,i.jsx)(es,{table:n,isAutofixViewSecurityModalOpen:Y,setIsAutofixViewSecurityModalOpen:$,"data-sentry-element":"ViewEntityAutofixSecurityModal","data-sentry-source-file":"GridHeaderActions.tsx"}),c&&(0,i.jsx)(H.Z,{danger:n.rls_enabled,visible:C,title:"Confirm to enable Row Level Security",description:"Are you sure you want to enable Row Level Security for this table?",buttonLabel:"Enable RLS",buttonLoadingLabel:"Updating",onSelectCancel:ew,onSelectConfirm:eS})]})},eu=n(31472),em=n(13064),ef=n(44735),eh=e=>{let{id:t}=e;return(0,i.jsx)("div",{className:"flex items-center justify-center h-full","data-sentry-component":"NotFoundState","data-sentry-source-file":"NotFoundState.tsx",children:(0,i.jsx)("div",{className:"w-[400px]",children:(0,i.jsx)(em.Z,{icon:(0,i.jsx)(ef.Z,{strokeWidth:2}),title:"Unable to find your table with ID ".concat(t),"data-sentry-element":"InformationBox","data-sentry-source-file":"NotFoundState.tsx"})})})},ep=n(42533),eg=n(67333),ex=n(85229),ev=n(98809),ey=n(99968),eb=n(63621),ej=n(87882);let ew=e=>{let{id:t}=e;return"\n    ".concat(ej.k,"\n\n    with table_info as (\n      select \n        n.nspname::text as schema,\n        c.relname::text as name\n      from pg_class c\n      join pg_namespace n on n.oid = c.relnamespace\n      where c.oid = ").concat(t,"\n    )\n    select pg_temp.pg_get_tabledef (\n      t.schema,\n      t.name,\n      false,\n      'FKEYS_INTERNAL',\n      'INCLUDE_TRIGGERS'\n    ) as definition\n    from table_info t;\n  ").trim()};async function eS(e,t){let{projectRef:n,connectionString:i,id:a}=e;if(!a)throw Error("id is required");let o=ew({id:a}),{result:r}=await (0,$.R)({projectRef:n,connectionString:i,sql:o,queryKey:["table-definition",a]},t);return r[0].definition.trim()}let eN=function(e){let{projectRef:t,connectionString:n,id:i}=e,{enabled:a=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,Y.a)(ee.A.tableDefinition(t,i),e=>{let{signal:a}=e;return eS({projectRef:t,connectionString:n,id:i},a)},{enabled:a&&void 0!==t&&void 0!==i&&!isNaN(i),...o})};var eD=n(37462),eC=n(45536),eA=e=>{let{entity:t}=e,{ref:n}=(0,m.UO)(),a=(0,z.useRef)(null),o=(0,z.useRef)(null),{resolvedTheme:r}=(0,ev.F)(),{project:l}=(0,p.d2)(),s=ei({id:null==t?void 0:t.id,projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString},{enabled:(0,x.D1)(t)}),c=eN({id:null==t?void 0:t.id,projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString},{enabled:(0,x.N3)(t)}),{data:d,isLoading:u}=(0,x.D1)(t)?s:c,f=(0,x.Du)(t)?"create view ".concat(t.schema,".").concat(t.name," as\n"):(0,x.z_)(t)?"create materialized view ".concat(t.schema,".").concat(t.name," as\n"):"",h=(0,z.useMemo)(()=>d?(0,eD._)(f+d):void 0,[d]),g=async(e,t)=>{a.current=e,o.current=t,e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),await (0,eC.Vs)(500),null==e||e.focus()};return u?(0,i.jsxs)("div",{className:"h-full grid",children:[(0,i.jsx)("div",{className:"p-4",children:(0,i.jsx)(eb.A,{})}),(0,i.jsx)("div",{className:"mt-auto",children:(0,i.jsx)(ey.Z,{})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex-grow overflow-y-auto border-t border-muted relative",children:[(0,i.jsx)(P.z,{asChild:!0,type:"default",className:"absolute top-2 right-5 z-10","data-sentry-element":"Button","data-sentry-source-file":"TableDefinition.tsx",children:(0,i.jsx)(L(),{href:"/project/".concat(n,"/sql/new?content=").concat(encodeURIComponent(null!=h?h:"")),"data-sentry-element":"Link","data-sentry-source-file":"TableDefinition.tsx",children:"Open in SQL Editor"})}),(0,i.jsx)(ex.default,{className:"monaco-editor",theme:(null==r?void 0:r.includes("dark"))?"vs-dark":"vs",onMount:g,defaultLanguage:"pgsql",value:h,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0},"data-sentry-element":"Editor","data-sentry-source-file":"TableDefinition.tsx"})]}),(0,i.jsx)(ey.Z,{"data-sentry-element":"Footer","data-sentry-source-file":"TableDefinition.tsx"})]})},eE=e=>{var t,n;let{theme:r="dark",isLoadingSelectedTable:s=!1,selectedTable:A}=e,E=(0,d.useRouter)(),{ref:R,id:_}=(0,m.UO)(),{project:k}=(0,p.d2)(),L=(0,C._2)(),z=(0,D.z6)(),[{view:Z="data"}]=(0,w.x)(),T=(0,b.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"tables"),I=(0,b.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"columns"),F=!T&&!I,q=(0,o.NL)(),{mutate:O}=(0,y.Gz)({async onMutate(e){let{projectRef:t,table:n,configuration:i,payload:a}=e,o=new Set(Object.keys(i.identifiers)),r=v.s.tableRows(t,{table:{id:n.id}});await q.cancelQueries(r);let l=q.getQueriesData(r);return q.setQueriesData(r,e=>{var t;return{rows:null!==(t=null==e?void 0:e.rows.map(e=>Object.entries(e).filter(e=>{let[t]=e;return o.has(t)}).every(e=>{let[t,n]=e;return n===i.identifiers[t]})?{...e,...a}:e))&&void 0!==t?t:[]}}),{previousRowsQueries:l}},onError(e,t,n){let{previousRowsQueries:i}=n;i.forEach(e=>{let[t,n]=e;n&&q.setQueriesData(t,n),q.invalidateQueries(t)}),J(e)}}),W=(0,j.Z)(null!==(t=null==A?void 0:A.columns)&&void 0!==t?t:N.Z6);if(s)return(0,i.jsx)(eu.h,{});if(c()(A))return(0,i.jsx)(eh,{id:Number(_)});let M=(0,x.Du)(A)||(0,x.z_)(A),V=(0,x.N3)(A),U=S.s.includes(null!==(n=null==A?void 0:A.schema)&&void 0!==n?n:""),Q=V&&!U,G=(0,h.NK)(A),P="".concat(A.schema,"_").concat(A.name),J=e=>{var t,n;u.Am.error(null!==(n=null!==(t=null==e?void 0:e.details)&&void 0!==t?t:null==e?void 0:e.message)&&void 0!==n?n:e)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.z,{theme:r,gridProps:{height:"100%"},projectRef:R,editable:!F&&Q,schema:A.schema,table:G,headerActions:(0,i.jsx)(ed,{table:A,canEditViaTableEditor:Q}),onAddColumn:L.onAddColumn,onEditColumn:e=>{let t=l()(W.current,{name:e});t?L.onEditColumn(t):u.Am.error("Unable to find column ".concat(e," in ").concat(null==A?void 0:A.name))},onDeleteColumn:e=>{var t;let n=l()(null!==(t=W.current)&&void 0!==t?t:[],{name:e});n?L.onDeleteColumn(n):u.Am.error("Unable to find column ".concat(e," in ").concat(null==A?void 0:A.name))},onAddRow:L.onAddRow,updateTableRow:(e,t)=>{var n;if(!k)return;let a=null===(n=A.columns)||void 0===n?void 0:n.filter(e=>{var t;return(null!==(t=null==e?void 0:e.enums)&&void 0!==t?t:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name),o={};if((0,x.N3)(A)&&A.primary_keys.forEach(t=>{let n=A.columns.find(e=>e.name===t.name);o[t.name]=(null==n?void 0:n.format)==="bytea"?(0,ep.D4)(e[t.name]):e[t.name]}),0===Object.keys(o).length)return(0,u.Am)("Unable to update row as table has no primary keys",{description:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,i.jsx)("div",{className:"mt-3",children:(0,i.jsx)(g.G,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})});O({projectRef:k.ref,connectionString:k.connectionString,table:A,configuration:{identifiers:o},payload:t,enumArrayColumns:a,impersonatedRole:z()})},onEditRow:L.onEditRow,onImportData:L.onImportData,onError:J,onExpandJSONEditor:(e,t)=>{L.onExpandJSONEditor({column:e,row:t,value:JSON.stringify(t[e])||""})},onExpandTextEditor:(e,t)=>{L.onExpandTextEditor(e,t)},onEditForeignKeyColumnValue:L.onEditForeignKeyColumnValue,showCustomChildren:(M||V)&&"definition"===Z,customHeader:(M||V)&&"definition"===Z?(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsxs)("p",{children:["SQL Definition of ",(0,i.jsx)("code",{className:"text-sm",children:A.name})," "]}),(0,i.jsx)("p",{className:"text-foreground-light text-sm",children:"(Read only)"})]}):null,"data-sentry-element":"SupabaseGrid","data-sentry-source-file":"TableGridEditor.tsx",children:(M||V)&&(0,i.jsx)(eA,{entity:A})},P),(0,i.jsx)(eg.Z,{editable:!F&&Q,selectedTable:(0,x.N3)(A)?A:void 0,onTableCreated:e=>{E.push("/project/".concat(R,"/editor/").concat(e.id))},"data-sentry-element":"SidePanelEditor","data-sentry-source-file":"TableGridEditor.tsx"})]})};n(46908)},92259:function(e,t,n){n.d(t,{r:function(){return c}});var i=n(28894),a=n(6464),o=n(62432),r=n(37756),l=n(98775);async function s(e,t,n){let{projectRef:i,connectionString:o,schema:r}=e;if(!i)throw Error("projectRef is required");let l=new Headers(n);o&&l.set("x-connection-encrypted",o);let{data:s,error:c}=await (0,a.U2)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":o},path:{ref:i},query:{included_schemas:r||"",excluded_schemas:""}},headers:l,signal:t});return c&&(0,a.S3)(c),s}let c=function(e){let{projectRef:t,connectionString:n,schema:a}=e,{enabled:c=!0,...d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=(0,o.Vm)(),m=(null==u?void 0:u.status)===r.S.ACTIVE_HEALTHY;return(0,i.a)(l.R.list(t,a),e=>{let{signal:i}=e;return s({projectRef:t,connectionString:n,schema:a},i)},{enabled:c&&void 0!==t&&m,...d})}},25024:function(e,t,n){n.d(t,{k:function(){return l}});var i=n(62213);let a={search:"",timestampStart:"",timestampEnd:"",filters:{}},o=e=>(0,i.jo)({parse:t=>null!=t?t:e,serialize:e=>e||""}),r=e=>(0,i.jo)({parse:t=>{if(!t)return e;try{return JSON.parse(t)}catch(t){return e}},serialize:e=>{if(!e)return"";try{return JSON.stringify(e)}catch(e){return""}}});function l(){let[e,t]=(0,i.v1)("s",o(a.search)),[n,l]=(0,i.v1)("its",o(a.timestampStart)),[s,c]=(0,i.v1)("ite",o(a.timestampEnd)),[d,u]=(0,i.v1)("log",o("")),[m,f]=(0,i.v1)("f",r(a.filters)),h=e||a.search,p=n||a.timestampStart,g=s||a.timestampEnd,x=m||a.filters,v=e=>{t(e||a.search)},y=e=>{f(e||a.filters)};return{search:h,timestampStart:p,timestampEnd:g,selectedLogId:d||null,filters:x,setSearch:v,setTimeRange:(e,t)=>{l(e||a.timestampStart),c(t||a.timestampEnd)},setSelectedLogId:e=>{u(e||"")},setFilters:y,updateFilter:(e,t)=>{y({...x,[e]:t})},reset:()=>{v(a.search),l(a.timestampStart),c(a.timestampEnd),u(""),f(a.filters)}}}},50936:function(e,t,n){n.d(t,{Z:function(){return F}});var i=n(97458),a=n(4839),o=n(83145),r=n.n(o),l=n(34549),s=n(27850),c=n(88971),d=n(62423),u=n(36457),m=n(64618),f=n(65051),h=n(25878),p=n(99492),g=n(24561),x=n(79790),v=n(62175);async function y(e){let{projectRef:t,connectionString:n,table:i,filters:a,impersonatedRole:o}=e,r=(0,p.Jh)(function(e){var t;let{table:n,filters:i}=e,a=new f.A().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).delete();return i.filter(e=>e.value&&""!==e.value).forEach(e=>{let t=(0,v.q)(n,e);a=a.filter(e.column,e.operator,t)}),a.toSql()}({table:i,filters:a}),{projectRef:t,role:o}),{result:l}=await (0,h.R)({projectRef:t,connectionString:n,sql:r,isRoleImpersonationEnabled:(0,g.Gm)(o)});return l}let b=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,u.NL)();return(0,m.D)(e=>y(e),{async onSuccess(t,n,a){let{projectRef:o,table:r}=n;await i.invalidateQueries(x.s.tableRowsAndCount(o,r.id)),await (null==e?void 0:e(t,n,a))},async onError(e,n,i){void 0===t?l.Am.error("Failed to delete all table rows: ".concat(e.message)):t(e,n,i)},...n})};var j=n(49996),w=n(67096);async function S(e){let{projectRef:t,connectionString:n,table:i,rows:a,impersonatedRole:o}=e,r=(0,p.Jh)(function(e){var t;let{table:n,rows:i}=e,{primaryKeys:a,error:o}=(0,v.h)({table:n});if(o)throw o;let r=new f.A().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).delete();return null==a||a.forEach(e=>{let t=i.map(t=>t[e]);r=r.filter(e,"in",t)}),r.toSql()}({table:i,rows:a}),{projectRef:t,role:o}),{result:l}=await (0,h.R)({projectRef:t,connectionString:n,sql:r,isRoleImpersonationEnabled:(0,g.Gm)(o)});return l}let N=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,u.NL)();return(0,m.D)(e=>S(e),{async onSuccess(t,n,i){let{projectRef:o,table:r}=n;await a.invalidateQueries(x.s.tableRowsAndCount(o,r.id)),await (null==e?void 0:e(t,n,i))},async onError(e,n,a){if(void 0===t){let{table:t,rows:a}=n,o=e.message.includes("Please add a primary key column"),r=e.message.includes("violates foreign key constraint"),s=a.length>1;if(r){let n=t.name,a=e.message.split("on table ")[2].replaceAll('"',""),o=e.message.split("foreign key constraint")[1].split("on table")[0].replaceAll('"',""),r=s?"Unable to delete rows as one of them is currently referenced by a foreign key constraint from the table `".concat(a,"`."):"Unable to delete row as it is currently referenced by a foreign key constraint from the table `".concat(a,"`."),c="Set an on delete behavior on the foreign key relation `".concat(o,"` in the `").concat(a,"` table to automatically respond when row(s) are being deleted in the `").concat(n,"` table.");(0,l.Am)(r,{description:(0,i.jsx)(j.U,{content:c,className:"[&>p]:m-0"}),action:(0,i.jsx)("div",{className:"w-full flex gap-x-2 !mx-0 mt-3",children:(0,i.jsx)(w.G,{href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes"})})})}else o?(0,l.Am)("Unable to delete row(s) as table has no primary keys",{description:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,i.jsx)("div",{className:"mt-3",children:(0,i.jsx)(w.G,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})}):l.Am.error("Failed to delete table row: ".concat(e.message))}else t(e,n,a)},...n})};async function D(e){let{projectRef:t,connectionString:n,table:i}=e,a=function(e){var t;let{table:n}=e;return new f.A().from(n.name,null!==(t=n.schema)&&void 0!==t?t:void 0).truncate().toSql()}({table:i}),{result:o}=await (0,h.R)({projectRef:t,connectionString:n,sql:a});return o}let C=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,u.NL)();return(0,m.D)(e=>D(e),{async onSuccess(t,n,a){let{projectRef:o,table:r}=n;await i.invalidateQueries(x.s.tableRowsAndCount(o,r.id)),await (null==e?void 0:e(t,n,a))},async onError(e,n,i){void 0===t?l.Am.error("Failed to truncate table row: ".concat(e.message)):t(e,n,i)},...n})};var A=n(73167),E=n(79581),R=n(17319),_=n(53114),k=n(56844),L=n(96226),z=n(10046),Z=n(10947),T=n(90839),I=n(32002),F=e=>{var t,n,o,u,m,f,h,p,x;let{selectedTable:v,onAfterDeleteTable:y=k.ZT}=e,{project:j}=(0,c.d2)(),w=(0,L._2)(),{selectedSchema:S}=(0,R.B)(),[{filter:D},F]=(0,_.x)({arrayKeys:["filter","sort"]}),q=(0,s.Yb)(D),O=(0,E.AF)({projectRef:null==j?void 0:j.ref,connectionString:null==j?void 0:j.connectionString}),W=e=>{F(t=>{var n,i;let a=null!==(n=null==t?void 0:t.filter)&&void 0!==n?n:[],o=null!==(i=null==t?void 0:t.sort)&&void 0!==i?i:[];return{...t,filter:a.filter(t=>{let[n]=t.split(":");if(n!==e)return t}),sort:o.filter(t=>{let[n]=t.split(":");if(n!==e)return t})}})},{mutate:M}=(0,d.v)({onSuccess:()=>{var e;if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="column")return;let t=w.confirmationDialog.column;W(t.name),l.Am.success('Successfully deleted column "'.concat(t.name,'"'))},onError:e=>{var t;if((null===(t=w.confirmationDialog)||void 0===t?void 0:t.type)!=="column")return;let n=w.confirmationDialog.column;l.Am.error("Failed to delete ".concat(n.name,": ").concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:V}=(0,A.H)({onSuccess:async()=>{y(await O(S)),l.Am.success('Successfully deleted table "'.concat(null==v?void 0:v.name,'"'))},onError:e=>{l.Am.error("Failed to delete ".concat(null==v?void 0:v.name,": ").concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:U}=N({onSuccess:()=>{var e,t,n;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(t=(n=w.confirmationDialog).callback)||void 0===t||t.call(n)),l.Am.success("Successfully deleted selected row(s)")},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:Q}=b({onSuccess:()=>{var e,t,n;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(t=(n=w.confirmationDialog).callback)||void 0===t||t.call(n)),l.Am.success("Successfully deleted selected rows")},onError:e=>{l.Am.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),{mutate:G}=C({onSuccess:()=>{var e,t,n;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(t=(n=w.confirmationDialog).callback)||void 0===t||t.call(n)),l.Am.success("Successfully deleted all rows from table")},onError:e=>{l.Am.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{w.closeConfirmationDialog()}}),P=(null===(t=w.confirmationDialog)||void 0===t?void 0:t.type)==="row"&&w.confirmationDialog.allRowsSelected,J=(null===(n=w.confirmationDialog)||void 0===n?void 0:n.type)==="row"?w.confirmationDialog.allRowsSelected?null!==(x=w.confirmationDialog.numRows)&&void 0!==x?x:0:w.confirmationDialog.rows.length:0,K=((null===(o=w.confirmationDialog)||void 0===o?void 0:o.type)==="column"||(null===(u=w.confirmationDialog)||void 0===u?void 0:u.type)==="table")&&w.confirmationDialog.isDeleteWithCascade,H=async()=>{var e;if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="column"||void 0===j)return;let t=w.confirmationDialog.column;void 0!==t&&M({id:t.id,cascade:K,projectRef:j.ref,connectionString:null==j?void 0:j.connectionString,table:v})},X=async()=>{var e;(null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)==="table"&&void 0!==v&&V({projectRef:null==j?void 0:j.ref,connectionString:null==j?void 0:j.connectionString,schema:v.schema,id:v.id,cascade:K})},B=(0,g.z6)(),Y=async()=>{var e;if(!j)return console.error("Project ref is required");if(!v)return console.error("Selected table required");if((null===(e=w.confirmationDialog)||void 0===e?void 0:e.type)!=="row")return;let t=w.confirmationDialog.rows;if(w.confirmationDialog.allRowsSelected){if(0===q.length){if(void 0!==B())return w.closeConfirmationDialog(),l.Am.error("Table truncation is not supported when impersonating a role");G({projectRef:j.ref,connectionString:j.connectionString,table:v})}else Q({projectRef:j.ref,connectionString:j.connectionString,table:v,filters:q,impersonatedRole:B()})}else U({projectRef:j.ref,connectionString:j.connectionString,table:v,rows:t,impersonatedRole:B()})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(I.Z,{variant:"destructive",size:"small",visible:(null===(m=w.confirmationDialog)||void 0===m?void 0:m.type)==="column",title:'Confirm deletion of column "'.concat((null===(f=w.confirmationDialog)||void 0===f?void 0:f.type)==="column"&&w.confirmationDialog.column.name,'"'),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{w.closeConfirmationDialog()},onConfirm:H,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,i.jsx)(z.Z,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:K,onChange:()=>w.toggleConfirmationIsWithCascade(),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),K&&(0,i.jsxs)(Z.bZ,{variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,i.jsx)(Z.Cd,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,i.jsx)(Z.X,{children:(0,i.jsx)(T.z,{asChild:!0,size:"tiny",type:"default",icon:(0,i.jsx)(a.Z,{}),children:(0,i.jsx)(r(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,i.jsx)(I.Z,{variant:"destructive",size:"small",visible:(null===(h=w.confirmationDialog)||void 0===h?void 0:h.type)==="table",title:(0,i.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null==v?void 0:v.name,'"')}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{w.closeConfirmationDialog()},onConfirm:X,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,i.jsx)(z.Z,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:K,onChange:()=>w.toggleConfirmationIsWithCascade(!K),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),K&&(0,i.jsxs)(Z.bZ,{variant:"warning",children:[(0,i.jsx)(Z.Cd,{children:"Warning: Dropping with cascade may result in unintended consequences"}),(0,i.jsx)(Z.X,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,i.jsx)(Z.X,{className:"mt-4",children:(0,i.jsx)(T.z,{asChild:!0,size:"tiny",type:"default",icon:(0,i.jsx)(a.Z,{}),children:(0,i.jsx)(r(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,i.jsx)(I.Z,{variant:"destructive",size:"small",visible:(null===(p=w.confirmationDialog)||void 0===p?void 0:p.type)==="row",title:(0,i.jsxs)("p",{className:"break-words",children:[(0,i.jsx)("span",{children:"Confirm to delete the selected row"}),(0,i.jsx)("span",{children:J>1&&"s"})]}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>w.closeConfirmationDialog(),onConfirm:()=>Y(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:[(0,i.jsx)("span",{children:"Are you sure you want to delete "}),(0,i.jsxs)("span",{children:[P?"all":"the selected"," "]}),(0,i.jsx)("span",{children:J>1&&"".concat(J," ")}),(0,i.jsx)("span",{children:"row"}),(0,i.jsx)("span",{children:J>1&&"s"}),(0,i.jsx)("span",{children:"? This action cannot be undone."})]})})})]})}},66318:function(e,t,n){var i=n(97458),a=n(62507),o=n(57304),r=n(52983),l=n(45536),s=n(90839),c=n(65092);t.Z=e=>{var t;let{text:n,asyncText:d,iconOnly:u=!1,children:m,onClick:f,copyLabel:h="Copy",copiedLabel:p="Copied",...g}=e,[x,v]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(!x)return;let e=setTimeout(()=>v(!1),2e3);return()=>clearTimeout(e)},[x]),(0,i.jsx)(s.z,{onClick:async e=>{let t=d?await d():n;v(!0),await (0,l.vQ)(t),null==f||f(e)},...g,className:(0,c.cn)({"px-1":u},g.className),icon:x?(0,i.jsx)(a.Z,{strokeWidth:2,className:"text-brand"}):null!==(t=g.icon)&&void 0!==t?t:(0,i.jsx)(o.Z,{}),"data-sentry-element":"Button","data-sentry-component":"CopyButton","data-sentry-source-file":"CopyButton.tsx",children:!u&&(0,i.jsx)(i.Fragment,{children:null!=m?m:x?p:h})})}},32472:function(e,t,n){var i=n(97458),a=n(52983),o=n(42155),r=n(19540),l=n(90839);t.Z=e=>{let{visible:t=!1,danger:n=!1,title:s="",description:c="",size:d="small",buttonLabel:u="",buttonLoadingLabel:m="",onSelectCancel:f=()=>{},onSelectConfirm:h=()=>{}}=e;(0,a.useEffect)(()=>{t&&g(!1)},[t]);let[p,g]=(0,a.useState)(!1),x=()=>{g(!0),h()};return(0,i.jsx)(o.Z,{header:s,visible:t,title:s,description:c,size:d,hideFooter:!0,onCancel:f,"data-sentry-element":"Modal","data-sentry-component":"ConfirmModal","data-sentry-source-file":"ConfirmDialog.tsx",children:(0,i.jsx)(r.Z,{initialValues:{},validateOnBlur:!0,onSubmit:()=>x(),validate:()=>[],"data-sentry-element":"Form","data-sentry-source-file":"ConfirmDialog.tsx",children:()=>(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(o.Z.Content,{children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(l.z,{block:!0,htmlType:"button",type:"default",onClick:f,disabled:p,children:"Cancel"}),(0,i.jsx)(l.z,{htmlType:"submit",block:!0,type:n?"danger":"primary",disabled:p,loading:p,children:m&&p?m:u||"Confirm"})]})})})})})}}}]);